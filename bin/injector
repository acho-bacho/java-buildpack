#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# fail fast
set -e

# parse args
BUILD_DIR=$1
CACHE_DIR=$2

# Gets Common JVM Buildpack BASH Functions
curl --silent --location http://heroku-jvm-common.s3.amazonaws.com/jvm-buildpack-common.tar.gz | tar xz
. bin/java

# create default system.properties 
if [ ! -f ${BUILD_DIR}/system.properties ]; then
  echo "java.runtime.version=1.8" > ${BUILD_DIR}/system.properties
fi

# install JDK 
javaVersion=$(detect_java_version ${BUILD_DIR})
echo -n "### Installing OpenJDK ${javaVersion}..."
install_java ${BUILD_DIR} ${javaVersion}
jdk_overlay ${BUILD_DIR}
echo "### installed java to ${BUILD_DIR}"

cd $BUILD_DIR

#Injector jars
wget https://raw.githubusercontent.com/acho-bacho/jar-store/master/InjectorLib.jar --directory-prefix=lib

# injector script that just calls the jars
wget https://raw.githubusercontent.com/acho-bacho/jar-store/master/inject
chmod +x inject
${BUILD_DIR}/inject


echo "### Finished"